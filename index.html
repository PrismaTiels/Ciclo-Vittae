<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ciclo Vitae - Despertar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@700;900&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --accent: #8b5cf6;
            --bg-deep: #030305;
        }

        body { 
            background-color: var(--bg-deep); 
            background: radial-gradient(circle at center, #0a0a15 0%, #030305 100%);
            color: #a1a1aa; 
            font-family: 'Inter', sans-serif; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            min-height: 100vh; 
            margin: 0; 
            padding: 20px; /* Evita que o card toque as bordas no mobile */
        }

        .font-title { font-family: 'Outfit', sans-serif; }

        .glass-card { 
            background: rgba(255, 255, 255, 0.02); 
            border: 1px solid rgba(255, 255, 255, 0.05); 
            border-radius: 32px; 
            padding: 40px 30px; 
            width: 100%; 
            max-width: 400px; 
            text-align: center; 
            backdrop-filter: blur(20px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.8s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .input-group label {
            display: block;
            text-align: center;
            font-size: 10px;
            text-transform: uppercase;
            font-weight: 800;
            letter-spacing: 0.15em;
            color: var(--accent);
            margin-bottom: 8px;
            opacity: 0.8;
        }

        input { 
            background: rgba(0, 0, 0, 0.2); 
            border: 1px solid rgba(255, 255, 255, 0.08); 
            border-radius: 16px; 
            padding: 16px; 
            width: 100%; 
            color: white; 
            outline: none; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 15px;
            text-align: center;
        }

        input:focus { 
            border-color: var(--accent); 
            background: rgba(139, 92, 246, 0.05);
            box-shadow: 0 0 15px rgba(139, 92, 246, 0.1);
            transform: scale(1.02);
        }

        .btn-entrar { 
            background: var(--accent); 
            color: white; 
            font-weight: 900; 
            text-transform: uppercase; 
            letter-spacing: 0.1em;
            width: 100%; 
            padding: 18px; 
            border-radius: 16px; 
            margin-top: 20px; 
            cursor: pointer; 
            transition: all 0.4s; 
            border: none;
            position: relative;
            overflow: hidden;
        }

        .btn-entrar:hover { 
            box-shadow: 0 10px 25px rgba(139, 92, 246, 0.4); 
            transform: translateY(-2px);
            filter: brightness(1.1);
        }

        .btn-entrar:active { transform: translateY(0); }

        .subtitle {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.25em;
            color: #52525b;
            margin-bottom: 8px;
            display: block;
        }

        /* Ajustes para telas bem pequenas */
        @media (max-width: 380px) {
            .glass-card { padding: 30px 20px; }
            h1 { font-size: 1.875rem !important; }
        }
    </style>
</head>
<body>

    <div class="glass-card">
        <h1 class="text-4xl font-title text-white font-black italic uppercase mb-2 tracking-tighter">
            Ciclo <span style="color: var(--accent);">Vitae</span>
        </h1>
        <span class="subtitle mb-10">o pós vida lhe aguarda</span>
        
        <div class="space-y-6">
            <div class="input-group">
                <label>Personagem</label>
                <input type="text" id="charName" placeholder="Nome do Personagem" autocomplete="off">
            </div>
            
            <div class="input-group">
                <label>Player</label>
                <input type="text" id="playerName" placeholder="Seu nome" autocomplete="off">
            </div>
        </div>

        <button onclick="iniciar()" class="btn-entrar">
            Entrar
        </button>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAzDHaOYApynTHqdvhWy4FhUvwLXr5zfuc",
        authDomain: "ciclo-vittae.firebaseapp.com",
        projectId: "ciclo-vittae",
        storageBucket: "ciclo-vittae.firebasestorage.app",
        messagingSenderId: "595476111730",
        appId: "1:595476111730:web:a04d2d53f3d5f9c902fdeb"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const skillsMap = {
        "Acrobacia": "Projeção", "Adestramento": "Encantamento", "Atletismo": "Influencia",
        "Atuação": "Encantamento", "Cura": "Conhecimento", "Diplomacia": "Encantamento",
        "Enganação": "Encantamento", "Fortitude": "Vitalidade", "Furtividade": "Projeção",
        "Iniciativa": "Projeção", "Intimidação": "Encantamento", "Intuição": "Espiritualidade",
        "Investigação": "Conhecimento", "Ladinagem": "Projeção", "Luta": "Influencia",
        "Misticismo": "Espiritualidade", "Percepção": "Projeção", "Pilotagem": "Projeção",
        "Pontaria": "Projeção", "Reflexos": "Projeção", "Religião": "Conhecimento",
        "Sobrevivência": "Conhecimento", "Vontade": "Espiritualidade"
    };

    const getDefaultData = (nomeChar, nomePlayer) => ({
        estado: 'vivo',
        info: { nome: nomeChar, player: nomePlayer, profissao: '', idade: '', altura: '' },
        status: {
            Vida: { a: 10, m: 10 },
            Sanidade: { a: 10, m: 10 },
            Metafísica: {a: 10, m: 10},
            Opacidade: {a: 100, m: 100}
        },
        atributos: {
            Vitalidade: 1, Projeção: 1, Conhecimento: 1, 
            Encantamento: 1, Influencia: 1, Espiritualidade: 0
        },
        pericias: Object.keys(skillsMap).reduce((acc, skill) => {
            acc[skill] = { b: 0, t: false };
            return acc;
        }, {}),
        combate: [],
        inventario: [],
        habilidades: [],
        anotacoes: ''
    });

    window.iniciar = async () => {
        const charName = document.getElementById('charName').value.trim();
        const playerName = document.getElementById('playerName').value.trim();

        if (!charName || !playerName) {
            alert("Preencha os campos para continuar.");
            return;
        }

        const charID = charName.toLowerCase().replace(/\s+/g, '-');
        const docRef = doc(db, "personagens", charID);
        
        try {
            const docSnap = await getDoc(docRef);
            if (!docSnap.exists()) {
                const novosDados = getDefaultData(charName, playerName);
                await setDoc(docRef, novosDados);
            }
            localStorage.setItem('ciclo_char_id', charID);
            window.location.href = 'ficha.html'; 
        } catch (e) {
            alert("Erro de conexão: " + e.message);
        }
    };
</script>
</body>
</html>