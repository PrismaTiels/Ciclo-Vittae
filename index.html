<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Ciclo Vitae - Despertar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@700;900&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --accent: #8b5cf6;
            --bg-deep: #030305;
        }

        body { 
            background-color: var(--bg-deep); 
            color: #a1a1aa; 
            font-family: 'Inter', sans-serif; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            height: 100vh; 
            margin: 0; 
            overflow: hidden;
        }

        .font-title { font-family: 'Outfit', sans-serif; }

        .glass-card { 
            background: rgba(255, 255, 255, 0.01); 
            border: 1px solid rgba(255, 255, 255, 0.05); 
            border-radius: 32px; 
            padding: 50px 40px; 
            width: 100%; 
            max-width: 400px; 
            text-align: center; 
            backdrop-filter: blur(20px);
        }

        /* Centralização dos Labels e Inputs */
        .input-group label {
            display: block;
            text-align: center; /* Centralizado */
            font-size: 10px;
            text-transform: uppercase;
            font-weight: 800;
            letter-spacing: 0.1em;
            color: var(--accent);
            margin-bottom: 8px;
            opacity: 0.8;
        }

        input { 
            background: rgba(255, 255, 255, 0.03); 
            border: 1px solid rgba(255, 255, 255, 0.08); 
            border-radius: 16px; 
            padding: 14px; 
            width: 100%; 
            color: white; 
            outline: none; 
            transition: all 0.3s;
            font-size: 14px;
            text-align: center; /* Texto digitado centralizado */
        }

        input:focus { 
            border-color: var(--accent); 
            background: rgba(139, 92, 246, 0.05);
        }

        .btn-entrar { 
            background: var(--accent); 
            color: white; 
            font-weight: 900; 
            text-transform: uppercase; 
            letter-spacing: 0.1em;
            width: 100%; 
            padding: 16px; 
            border-radius: 16px; 
            margin-top: 30px; 
            cursor: pointer; 
            transition: 0.3s; 
            border: none;
        }

        .btn-entrar:hover { 
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.3); 
            filter: brightness(1.1);
        }

        .subtitle {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            color: #52525b;
            margin-bottom: 8px;
            display: block;
        }
    </style>
</head>
<body>

    <div class="glass-card">
        <h1 class="text-4xl font-title text-white font-black italic uppercase mb-2 tracking-tighter">
            Ciclo <span style="color: var(--accent);">Vitae</span>
        </h1>
        <span class="subtitle mb-10">o pós vida lhe aguarda</span>
        
        <div class="space-y-6">
            <div class="input-group">
                <label>Personagem</label>
                <input type="text" id="charName" placeholder="Nome do Personagem" autocomplete="off">
            </div>
            
            <div class="input-group">
                <label>Player</label>
                <input type="text" id="playerName" placeholder="Seu nome" autocomplete="off">
            </div>
        </div>

        <button onclick="iniciar()" class="btn-entrar">
            Entrar
        </button>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAzDHaOYApynTHqdvhWy4FhUvwLXr5zfuc",
        authDomain: "ciclo-vittae.firebaseapp.com",
        projectId: "ciclo-vittae",
        storageBucket: "ciclo-vittae.firebasestorage.app",
        messagingSenderId: "595476111730",
        appId: "1:595476111730:web:a04d2d53f3d5f9c902fdeb"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // 1. COPIAMOS O MAPA DE PERÍCIAS PARA O INDEX TAMBÉM
    const skillsMap = {
        "Acrobacia": "Projeção", "Adestramento": "Encantamento", "Atletismo": "Influencia",
        "Atuação": "Encantamento", "Cura": "Conhecimento", "Diplomacia": "Encantamento",
        "Enganação": "Encantamento", "Fortitude": "Vitalidade", "Furtividade": "Projeção",
        "Iniciativa": "Projeção", "Intimidação": "Encantamento", "Intuição": "Espiritualidade",
        "Investigação": "Conhecimento", "Ladinagem": "Projeção", "Luta": "Influencia",
        "Misticismo": "Espiritualidade", "Percepção": "Projeção", "Pilotagem": "Projeção",
        "Pontaria": "Projeção", "Reflexos": "Projeção", "Religião": "Conhecimento",
        "Sobrevivência": "Conhecimento", "Vontade": "Espiritualidade"
    };

    // 2. COPIAMOS A FUNÇÃO QUE GERA OS DADOS COMPLETOS
    const getDefaultData = (nomeChar, nomePlayer) => ({
        estado: 'vivo',
        info: { 
            nome: nomeChar, 
            player: nomePlayer, // Aqui salvamos o nome do player
            profissao: '', 
            idade: '', 
            altura: '' 
        },
        status: {
            Vida: { a: 10, m: 10 },
            Sanidade: { a: 10, m: 10 },
            Metafisica: {a: 10, m: 10}, // Adicionado para garantir compatibilidade
            Opacidade: {a: 100, m: 100}
        },
        // Aqui os atributos começam com 1 (antes o seu index estava salvando 0)
        atributos: {
            Vitalidade: 1, Projeção: 1, Conhecimento: 1, 
            Encantamento: 1, Influencia: 1, Espiritualidade: 0
        },
        // Gera todas as perícias corretamente no banco
        pericias: Object.keys(skillsMap).reduce((acc, skill) => {
            acc[skill] = { b: 0, t: false };
            return acc;
        }, {}),
        combate: [],
        inventario: [],
        habilidades: [],
        anotacoes: ''
    });

    window.iniciar = async () => {
        const charName = document.getElementById('charName').value.trim();
        const playerName = document.getElementById('playerName').value.trim();

        if (!charName || !playerName) {
            alert("Preencha os campos para continuar.");
            return;
        }

        const charID = charName.toLowerCase().replace(/\s+/g, '-');
        const docRef = doc(db, "personagens", charID);
        
        try {
            const docSnap = await getDoc(docRef);
            
            if (!docSnap.exists()) {
                // 3. AQUI ESTÁ A CORREÇÃO: Usamos a função para gerar o objeto completo
                const novosDados = getDefaultData(charName, playerName);
                await setDoc(docRef, novosDados);
                console.log("Novo personagem criado com dados padrão completos.");
            } else {
                console.log("Personagem já existe, carregando...");
            }

            localStorage.setItem('ciclo_char_id', charID);
            window.location.href = 'ficha.html'; 
        } catch (e) {
            console.error("Erro ao entrar:", e);
            alert("Erro de conexão: " + e.message);
        }
    };
</script>
</body>
</html>